# 智能旅行攻略规划师 - 使用指南

## 🎯 项目概述

智能旅行攻略规划师是一个基于MCP（微服务组件）架构和RAG（检索增强生成）技术的专业AI助手。它能够根据用户需求，实时获取天气、交通、人流等数据，结合深度旅游知识库，为用户生成个性化、动态且最优的旅行攻略。

## ✨ 核心特性

### 🧠 智能决策引擎
- **意图理解**: 自然语言处理，精准理解用户旅行需求
- **智能路由**: 根据需求动态调用相应的MCP服务
- **综合决策**: 多维度信息整合，生成最优方案

### 🌤️ 环境感知与风险评估
- **实时天气**: 调用高德地图天气API获取精确天气信息
- **风险预警**: 极端天气智能识别和预警
- **动态调整**: 根据天气状况自动调整行程建议

### 🚦 路径规划与交通保障
- **实时路况**: 获取道路交通状况，避开拥堵路段
- **精准导航**: 使用高德地图导航API提供详细路线
- **多模交通**: 支持驾车、公交、地铁等多种出行方式

### 👥 人流预测与优化
- **人流监测**: 实时获取景点人流密度信息
- **错峰建议**: 推荐最佳游览时间，避开拥挤时段
- **替代方案**: 智能推荐人流较少的替代景点

### 📚 RAG知识增强
- **深度攻略**: 涵盖景点详情、最佳时间、拍照技巧
- **隐藏玩法**: 当地人才知道的特色体验
- **美食推荐**: 精选周边餐厅和特色小食
- **实用贴士**: 交通、门票、注意事项等实用信息

### 💬 多轮对话交互
- **上下文维护**: 记忆对话历史，支持连续交互
- **主动澄清**: 信息不足时主动询问细节
- **个性化收集**: 了解用户偏好，定制专属方案

## 🚀 快速开始

### 环境要求
```bash
Python >= 3.8
依赖库：requests, datetime, logging, json, hashlib
```

### 安装部署
1. 确保所有必要文件存在：
   - `smart_travel_agent.py` - 主Agent类
   - `rag_knowledge_base.py` - RAG知识库
   - `mcp_services.py` - MCP服务框架
   - `config.py` - 配置文件
   - `demo_smart_travel_agent.py` - 演示脚本

2. 配置API密钥（在config.py中）：
   - 高德地图天气API KEY
   - 高德地图导航API KEY
   - 高德地图交通API KEY

### 运行演示
```bash
python demo_smart_travel_agent.py
```

## 📖 使用说明

### 基本用法
```python
from smart_travel_agent import SmartTravelAgent

# 初始化Agent
agent = SmartTravelAgent()

# 处理用户请求
response = agent.process_user_request("我想明天去外滩看夜景", "user_001")
print(response)
```

### 支持的查询类型

#### 1. 完整旅行规划
```
"我想明天从人民广场去外滩看夜景"
"带孩子去迪士尼乐园一日游"
"从虹桥机场到陆家嘴商务出行"
```

#### 2. 实时信息查询
```
"外滩今天天气怎么样"
"迪士尼现在人多吗"
"从市中心到浦东的路况如何"
```

#### 3. 详细攻略咨询
```
"东方明珠有什么游览贴士"
"豫园周边有哪些美食推荐"
"外滩最佳拍照地点在哪里"
```

## 🎯 工作流程

### 阶段1：需求理解与澄清
1. **意图分析**: 解析用户输入，识别地点、活动、时间等关键信息
2. **信息澄清**: 如果信息不足，主动询问起点、终点、偏好等
3. **精准定位**: 将模糊地点转换为精确的经纬度坐标

### 阶段2：环境感知与风险评估
1. **天气查询**: 调用天气MCP，获取目的地实时天气信息
2. **风险评估**: 检测极端天气，如暴雨、台风、高温等
3. **动态调整**: 根据风险等级建议调整行程或改期

### 阶段3：路径规划与交通保障
1. **路线规划**: 调用导航MCP，获取最优行驶路线
2. **路况查询**: 调用交通MCP，检查实时路况信息
3. **智能调整**: 如发现拥堵，自动规划避堵路线

### 阶段4：用户偏好收集
1. **偏好询问**: 了解活动类型、交通方式、时间安排等偏好
2. **个性化调整**: 根据用户回答优化攻略方案
3. **多轮交互**: 支持连续对话，逐步完善方案

### 阶段5：RAG增强与方案输出
1. **知识检索**: 从RAG知识库检索相关深度信息
2. **内容增强**: 添加最佳时间、拍照技巧、隐藏玩法等
3. **综合输出**: 生成结构化的完整旅行攻略

## 🔧 技术架构

### MCP服务框架
- **WeatherMCPService**: 天气信息服务
- **CrowdMCPService**: 人流信息服务  
- **TrafficMCPService**: 交通状况服务
- **NavigationMCPService**: 导航路径服务
- **POISearchMCPService**: POI搜索服务

### RAG知识库
- **景点知识**: 详细的景点信息和游览攻略
- **实用贴士**: 基于条件的实用建议
- **季节建议**: 不同季节的出行指导

### 智能决策
- **对话状态管理**: 维护多轮对话上下文
- **意图识别**: 自然语言理解和分类
- **风险评估**: 多维度风险分析和建议

## 📊 示例输出

### 完整攻略示例
```
🎯 外滩 智能旅行攻略
==================================================

📋 行程概览
• 出发地：人民广场
• 目的地：外滩
• 预计行程：15分钟
• 路程距离：2.3公里

🌤️ 实时环境信息
• 天气状况：晴 22°C
• 湿度：65%
• 风力：东南风 2级
• 人流状况：中等
• 预计等待：10-15分钟
• 最佳时间：傍晚18:00-20:00

🚗 交通指南
• 路况状况：当前交通状况良好，驾车出行较为便捷
• 详细路线：
  1. 从人民广场出发，向东步行至南京东路 (300米)
  2. 沿南京东路向东直行 (1.2公里)
  3. 至中山东一路右转即达外滩 (200米)
  ... (共8步)

💡 专业游览建议
• 最佳时机：傍晚18:00-20:00
  理由：日落时分可以看到黄浦江两岸从白天到夜晚的完美过渡
• 推荐拍照地点：
  📸 外白渡桥: 经典角度拍摄浦东天际线
  📸 和平饭店老楼: 复古建筑与现代建筑对比
  📸 十六铺码头: 低机位拍摄外滩建筑群
• 内行贴士：
  💡 避开国庆黄金周，人流是平时的5-10倍
  💡 工作日早晨最安静，适合深度游览
  💡 地铁2号线南京东路站2号出口最近

🍽️ 餐饮推荐
• 外滩18号 - 主营法餐 - 人均500+ - 黄浦江景观
• 老正兴 - 主营上海菜 - 人均150 - 百年老店
• 小南国 - 主营港式茶点 - 人均200 - 环境优雅

⚠️ 注意事项
• 出行前请再次确认天气和交通状况
• 建议携带身份证等必要证件
• 如有变化可随时咨询获取更新建议

🤖 如果行程有任何变动，或者您想了解更多信息，请随时告诉我！
```

## 🔍 常见问题

### Q: 如何获取API密钥？
A: 需要在高德开放平台注册并申请相应的API服务密钥。

### Q: Agent支持哪些城市？
A: 目前主要针对上海地区进行优化，支持上海主要景点和区域。

### Q: 如何添加新的景点知识？
A: 可以在`rag_knowledge_base.py`的`attractions_knowledge`中添加新景点信息。

### Q: 是否支持离线使用？
A: 设计目标是使用实时数据，但在网络不可用时会使用默认数据。

### Q: 如何自定义用户偏好？
A: Agent会在对话中主动询问偏好，也可以通过代码直接设置UserContext。

## 🛠️ 开发指南

### 添加新的MCP服务
1. 在`mcp_services.py`中创建新的服务类
2. 继承`MCPService`基类
3. 实现具体的服务方法
4. 在`MCPServiceManager`中注册新服务

### 扩展RAG知识库
1. 在`rag_knowledge_base.py`中添加新的知识条目
2. 遵循现有的数据结构规范
3. 可以添加新的知识类别和检索方法

### 优化智能决策
1. 在`smart_travel_agent.py`中调整决策逻辑
2. 可以添加新的意图识别规则
3. 优化风险评估和方案调整策略

## 📞 技术支持

如有技术问题或改进建议，欢迎联系开发团队。

---

**智能旅行攻略规划师 - 让每一次出行都成为完美体验！** 🌟
