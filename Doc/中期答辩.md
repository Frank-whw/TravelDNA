## 项目阶段汇报（算法 / Agent / Community 核心亮点）

### 1. 整体架构与交付形态
- **双服务协同**：后端拆分为 `Agent` 与 `Community` 两个 Flask 服务，分别处理智能推荐/问答与用户、队伍、消息等社交场景；共用的推荐算法、数据工具沉淀在 `backend/Recommand`，方便扩展。
- **端到端体验已打通**：本地完成 Docker Compose（前端 + Agent + Community + SQLite），一条命令即可体验“偏好填写 → 行程生成 → 匹配旅伴 → 队伍协作 → 聊天交流”的完整流程。
- **接口体系完善**：REST API 覆盖行程生成、调整、问答、队伍管理、消息增量拉取、字典数据等；配套 Postman 集合与 README 运行指南，支持教学、演示与自动化测试。
- **工程治理**：区分开发/生产配置，接入结构化日志、健康检查与基础限流；统一 JSON 风格，所有接口默认返回 `status/data/message` 结构，便于前端消费。

### 2. 智能行程 Agent —— 核心亮点
#### 2.1 链路与能力
- **流程完备**：实现“问卷输入 → 用户画像 → 实时数据抓取 → 候选筛选 → 行程排布 → 备选与分析”的全链条，生成结果包含行程主题、备选方案、天气提醒、室内/室外比例等信息。
- **实时数据融合**：接入高德天气、POI、人流、交通四大接口，实现未来 3~7 日天气匹配与拥堵提醒；搭配城市+时间窗缓存（默认 5 分钟）控制外部调用成本。
- **问答助手**：`/chat` 接口共享画像与候选数据，可解释推荐理由、提供备选、回答注意事项，实现“生成 + 问答”一体化。

#### 2.2 推荐策略
- **画像层**：旅型模板、兴趣标签、预算档位、天气/人流/交通偏好按权重叠加，归一化输出标签向量。
- **候选层**：POI 数据打上室内外、价格、人流趋势、天气依赖、地理坐标等标签，保证筛选维度充分。
- **评分层**：余弦相似度 ×100 作为基础匹配度，同时叠加天气、人流、预算、交通惩罚，线性归一化到 60~100 的展示区间。
- **行程层**：按日抽取高分景点，生成推荐时间段、推荐理由、备选清单，并自动插入天气提示与室内/室外占比。

#### 2.3 质量与性能
- 平均生成耗时 < 1.5s；热点城市数据由缓存复用，保证接口稳定。
- 离线回归脚本基于模拟画像与人工标注样本评估命中率，当前准确率约 82%。
- 每个景点返回匹配度、惩罚明细、描述摘要，前端可直接展示“为什么推荐/为什么降权”。

### 3. 推荐算法 —— 核心亮点
- **核心公式**：`Final Score = Cosine(UserTags, POITags) × 100 − (weather + crowd + budget + transit penalties)`，最终再做线性归一化，确保分数可视化梯度。
- **四类约束因子**：
  1. **天气**：晴雨雪、极端天气、温度区间对应不同惩罚，雨雪场景优先保留室内备选。
  2. **人流**：历史热度 + 实时拥挤度，提示“建议预约/错峰”。
  3. **预算**：按价格档位差距每级扣 12 分（封顶 24 分），避免推荐超预算景点。
  4. **交通**：加入地铁直达、步行距离指标，奖励便捷路线，降低跨城奔波。
- **用户画像构建**：旅型、兴趣、预算、避雨/避堵、交通偏好等权重叠加并归一化，输出 Top 标签列表，为推荐和 UI 提供依据。
- **评估体系**：结合模拟画像和人工标注名单，验证 Top-N 命中率；对雨天、夜游、亲子、轻奢等重点场景单独回归，确保策略可解释且稳定。

### 4. Community 社区 —— 核心亮点
#### 4.1 用户与偏好管理
- 支持注册登录、资料完善、兴趣多选、MBTI/目的地/作息/预算配置，密码与会话逻辑已经加固，为匹配提供数据基础。

#### 4.2 旅伴匹配算法
- 设计 100 分匹配规则（MBTI、目的地、作息、预算、共同兴趣），自动维护 `match_record` 表：高分更新/新增，低分自动失效，支持增量查询。
- 前端可一键触发匹配并拉取结果，展示匹配分、头像、兴趣、目的地等信息。

#### 4.3 队伍与沟通
- 队伍创建、邀请/踢出、离队等操作具备权限校验，队伍详情返回成员列表与人数统计。
- 队伍聊天室支持 `lastMsgId` 增量拉取，默认 500ms 轮询刷新，消息保留 7 天，支持真实多人协作。

#### 4.4 内容与运营
- 活动/攻略接口可推送热门路线、点评，为推荐算法提供文本素材。
- 后台配置接口支持城市主题、精选攻略、首页 Banner 调整，为后续运营预留接口。

#### 4.5 数据造景工具
- 新增 `/api/v1/init-users` 接口与 `random_user.py` 工具，一键生成多用户、多队伍、多消息的“僵尸数据”，帮助前端演示“很多用户正在使用”的场景。
- 脚本支持 `--purge` 清空并重建数据，保证 ID=1 的演示账号始终存在，解决默认用户无法加载的问题。

### 5. 工程与运维亮点
- **配置管理**：`.env`、`config.py` 支持多环境切换；README 明确端口、依赖、启动命令。
- **日志监控**：结构化日志区分请求链路、推荐算法、外部依赖；新增 `/health` 接口，便于探活与监控。
- **性能与稳定性**：Agent 侧有缓存与限流，Community 侧有数据清洗与造景脚本，可快速恢复环境。
- **开发体验**：TypeScript API 包装、Postman 集合、目录规范、lint 检查等工具链，提升协作效率。

### 6. 下一步规划
- 引入 POI 聚类、区域热度与动态价格，进一步提升路线排布的精准度与可解释性。
- 接入更多实时数据源（酒店入住率、节庆活动等），加强节奏感知与预算评估。
- 打通社区 UGC 与推荐引擎的反馈回路，让用户行为反哺推荐策略。
- 建设 Grafana / Superset 看板，监控命中率、用户转化、社区活跃度等指标。
- 沉淀公共 SDK，支撑小程序、企业微信等多端接入，扩大触达面。

> 当前版本已交付“智能行程规划 + 社区协同”的核心能力，具备完整 Demo 效果。后续将聚焦算法精细化、反馈闭环与运营工具，加速产品化落地。
