
注册和登录功能已完成。功能概览：

## 已完成的功能

### 1. **用户模型（User Model）**
- 已添加认证字段：`email`、`phone`、`password_hash`、`salt`、`status`
- 支持邮箱或手机号注册（至少一个）
- 密码加密存储

### 2. **注册路由**
- **端点**: `POST /api/v1/auth/register`
- **功能**:
  - 验证邮箱/手机号格式
  - 验证密码长度（至少6位）
  - 检查邮箱/手机号是否已存在
  - 密码加密存储（PBKDF2-HMAC-SHA256）
  - 创建新用户

### 3. **登录路由**
- **端点**: `POST /api/v1/auth/login`
- **功能**:
  - 支持邮箱或手机号登录
  - 验证密码
  - 检查账号状态（active/inactive/banned）
  - 返回用户信息（不含敏感信息）

### 4. **工具函数**
- `hash_password()` - 密码加密
- `verify_password()` - 密码验证
- `validate_email()` - 邮箱格式验证
- `validate_phone()` - 手机号格式验证

### 5. **路由已注册**
- 蓝图已注册到 Flask 应用
- URL 前缀：`/api/v1`
- CORS 已配置

## API 使用示例

### 注册接口

```bash
POST /api/v1/auth/register
Content-Type: application/json

{
  "email": "user@example.com",        # 可选，与phone至少一个
  "phone": "13800138000",              # 可选，与email至少一个
  "password": "password123",
  "name": "用户名",
  "gender": "男",
  "age": 25,
  "bio": "个人简介",                   # 可选
  "avatar": "头像URL"                  # 可选
}
```

**响应**:
```json
{
  "status": "success",
  "message": "注册成功",
  "data": {
    "id": 1,
    "name": "用户名",
    "email": "user@example.com",
    "status": "active",
    ...
  }
}
```

### 登录接口

```bash
POST /api/v1/auth/login
Content-Type: application/json

{
  "account": "user@example.com",  # 可以是邮箱或手机号
  "password": "password123"
}
```

**响应**:
```json
{
  "status": "success",
  "message": "登录成功",
  "data": {
    "id": 1,
    "name": "用户名",
    ...
  }
}
```

## 测试步骤

1. 执行数据库迁移（在 Supabase Dashboard 执行）：
   ```sql
   -- 执行 backend/Community/supabase/migrations/002_add_auth_fields_to_user.sql
   ```

2. 启动服务器：
   ```bash
   cd backend/Community
   python run.py
   ```

3. 测试功能：
   ```bash
   # 测试注册和登录
   python test_auth.py both
   
   # 或单独测试
   python test_auth.py register  # 只测试注册
   python test_auth.py login     # 只测试登录
   ```

4. 或用 curl/Postman 测试：
   ```bash
   # 注册
   curl -X POST http://localhost:8000/api/v1/auth/register \
     -H "Content-Type: application/json" \
     -d '{"email":"test@example.com","password":"test123","name":"测试","gender":"男","age":25}'
   
   # 登录
   curl -X POST http://localhost:8000/api/v1/auth/login \
     -H "Content-Type: application/json" \
     -d '{"account":"test@example.com","password":"test123"}'
   ```

